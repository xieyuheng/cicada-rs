<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-10-12 Thu 18:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>type system</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="xieyuheng" />
<link rel="stylesheet" href="../css/org-page.css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">type system</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1a66017"><span class="todo _todo_list_">[todo-list]</span> </a>
<ul>
<li><a href="#org4948f28">implementation</a></li>
<li><a href="#orge5b48b0">recall the old &lt;red-black-tree&gt; proof</a></li>
<li><a href="#org8eac57">use number theory &#x2013; to test type-checker as prover</a></li>
<li><a href="#orgf294d20">use category theory to test type-class</a></li>
</ul>
</li>
<li><a href="#org6484333"><span class="todo _note_">[note]</span> </a>
<ul>
<li><a href="#orge338f22">core</a></li>
<li><a href="#orga27bf35">trunk</a></li>
<li><a href="#org5d19acf">cut</a></li>
<li><a href="#org635d571">syntax</a>
<ul>
<li><a href="#org50a2c8b">(:)</a></li>
</ul>
</li>
<li><a href="#orgc119a38">we need many languages</a></li>
</ul>
</li>
<li><a href="#orge35f559">number</a>
<ul>
<li><a href="#orge7bb1f5">&lt;bool&gt;</a></li>
<li><a href="#orgfdf34a3">&lt;nat&gt;</a></li>
<li><a href="#org530bb96">&lt;even&gt;</a></li>
<li><a href="#org9dff5d1">&lt;eq&gt; &#x2013; an interface to the internal unification</a></li>
<li><a href="#orged99b90">add-associative &#x2013; structural induction proof</a></li>
<li><a href="#orgec3788">add-commutative</a></li>
<li><a href="#org1d1bf0d"><span class="todo _note_">[note]</span> type-check detail of 'add-zero-commutative'</a></li>
<li><a href="#orgfd487dc"><span class="todo _note_">[note]</span> type-check detail of 'add-commutative'</a></li>
</ul>
</li>
<li><a href="#orgda1f00a">&lt;list&gt;</a>
<ul>
<li><a href="#orgc3cb253">&lt;list&gt;</a></li>
<li><a href="#org9a30bd2">length</a></li>
<li><a href="#org5f10926">map</a></li>
<li><a href="#org3b12fa1">ref</a></li>
<li><a href="#orga7d323b">remove-first</a></li>
</ul>
</li>
<li><a href="#orgec9c72b">&lt;has-length&gt;</a>
<ul>
<li><a href="#org27acd45">&lt;has-length&gt;</a></li>
<li><a href="#org1d37588"><span class="todo _note_">[note]</span> type-check detail of 'map-has-length'</a></li>
</ul>
</li>
<li><a href="#orgb306304">&lt;sexp&gt; &#x2013; symbol expression</a>
<ul>
<li><a href="#orgc663cc0">&lt;sexp&gt;</a></li>
<li><a href="#org922da6b">subst</a></li>
</ul>
</li>
<li><a href="#org5ec846">&lt;lexp&gt; &#x2013; lambda expression</a>
<ul>
<li><a href="#org9457fc4">&lt;lexp&gt;</a></li>
<li><a href="#orgc223559">occurs-free?</a></li>
</ul>
</li>
<li><a href="#org914016c">&lt;vector&gt;</a>
<ul>
<li><a href="#org54e7379">&lt;vector&gt;</a></li>
<li><a href="#org987d8a6">append</a></li>
<li><a href="#org9168f4a">map</a></li>
<li><a href="#orgccaf9b5"><span class="todo _note_">[note]</span> type-check detail of 'append'</a></li>
<li><a href="#orgb74e388"><span class="todo _note_">[note]</span> type-check detail of 'map'</a></li>
<li><a href="#org80dc897">&lt;list&gt; as forgetful functor &#x2013; to reuse &lt;vector&gt;</a></li>
</ul>
</li>
<li><a href="#org720dba3">&lt;binary-tree&gt;</a>
<ul>
<li><a href="#org36a2069">&lt;binary-tree&gt;</a></li>
</ul>
</li>
<li><a href="#org43fcb5">&lt;binary-search-tree&gt;</a>
<ul>
<li><a href="#org21f1a3e">&lt;binary-search-tree&gt;</a></li>
<li><a href="#orgf92fdaa">search</a></li>
<li><a href="#org4451965">insert</a></li>
<li><a href="#org52fb483">delete</a></li>
</ul>
</li>
<li><a href="#org2fed7be"><span class="todo _gt__lt_">&gt;&lt;</span> &lt;red-black-tree&gt;</a>
<ul>
<li><a href="#org722aa0e"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org6832a36">&lt;red-black-tree&gt; &#x2013; extrinsic</a></li>
<li><a href="#org999306a">&lt;red-black-tree&gt; &#x2013; intrinsic</a></li>
</ul>
</li>
<li><a href="#orgff307da">type-class as subtype of </a>
<ul>
<li><a href="#org4b45594"></a></li>
<li><a href="#org1475610"></a></li>
<li><a href="#orgb1b99d2">&lt;maybe&gt;</a></li>
<li><a href="#orge68e0c0">&lt;state&gt;</a></li>
</ul>
</li>
<li><a href="#org11243ec">quotype &#x2013; quotient type</a>
<ul>
<li><a href="#org3b0822b"><span class="todo _note_">[note]</span> </a></li>
<li><a href="#org4bde230">&lt;int&gt;</a></li>
<li><a href="#org214446a">equal?</a></li>
<li><a href="#orgeadc8df">&lt;fraction&gt;</a></li>
<li><a href="#orgceab14c">equal?</a></li>
</ul>
</li>
</ul>
</div>
</div>
<ul class="org-ul">
<li><p>follow EOPL</p></li></ul>

<div id="outline-container-org1a66017" class="outline-2">
<h2 id="org1a66017"><span class="todo _todo_list_">[todo-list]</span> </h2>
<div class="outline-text-2" id="text-org1a66017">
</div><div id="outline-container-org4948f28" class="outline-3">
<h3 id="org4948f28">implementation</h3>
<div class="outline-text-3" id="text-org4948f28">
<ol class="org-ol">
<li>simple
<ul class="org-ul">
<li><p>unification</p><p>uses 'equal?'</p></li></ul></li>

<li>type-class
<ul class="org-ul">
<li><p>forgetful functor</p><p>code generation</p></li></ul></li>

<li>quotype
<ul class="org-ul">
<li><p>quotype</p><p>the concept of equivalence</p></li></ul></li>

<li>module
<ul class="org-ul">
<li><p>name space</p></li></ul></li></ol>
</div>
</div>

<div id="outline-container-orge5b48b0" class="outline-3">
<h3 id="orge5b48b0">recall the old &lt;red-black-tree&gt; proof</h3>
</div>

<div id="outline-container-org8eac57" class="outline-3">
<h3 id="org8eac57">use number theory &#x2013; to test type-checker as prover</h3>
</div>

<div id="outline-container-orgf294d20" class="outline-3">
<h3 id="orgf294d20">use category theory to test type-class</h3>
<div class="outline-text-3" id="text-orgf294d20">
<ul class="org-ul">
<li><p>group theory</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org6484333" class="outline-2">
<h2 id="org6484333"><span class="todo _note_">[note]</span> </h2>
<div class="outline-text-2" id="text-org6484333">
</div><div id="outline-container-orge338f22" class="outline-3">
<h3 id="orge338f22">core</h3>
<div class="outline-text-3" id="text-orge338f22">
<ul class="org-ul">
<li><p><p></p><p>can I re-design sequent0</p><p>by firstly design a small core ?</p><p></p></p><p></p><p><p></p><p>or can I design an over-simplified version first ?</p><p></p></p></li></ul>
</div>
</div>

<div id="outline-container-orga27bf35" class="outline-3">
<h3 id="orga27bf35">trunk</h3>
<div class="outline-text-3" id="text-orga27bf35">
<ul class="org-ul">
<li><p>local var can be non-determined</p></li>

<li><p>trunk as value which can be unified</p><p></p><p><ol class="org-ol"></p><p><li>there are non-determined var</li></p><p></p><p><li>when applying a function to non-determined var</p><p>it can not really return determined value</p><p>this is where we need to form a trunk</li></p><p></p><p><li>if we can not determine a non-determined trunk now</p><p>after some binding</p><p>we might be able to determine it</p><p>thus every time we see a trunk</p><p>we try to determine it</li></p><p></p><p><li>two non-determined trunk might be unified with each other</p><p>if the function body to be applied are</p><p>[structurally] the same</p><p>and their arguments can be unified</li></p><p></p><p><li><p></p><p>equivalence between function body</p><p>is not limited to 'structurally the same'</p><p></p></p><p></p><p><p></p><p>'add-commutative' is just saying (= {add} {swap add})</p><p>'add-associative' is just saying (= {add :z add} {:z add add})</p><p></p></p><p></p><p><p></p><p>we just need to supply the arguments of the function</p><p>to get back (+proof add-commutative)</p><p>and (+proof add-commutative)</p><p></p></li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-org5d19acf" class="outline-3">
<h3 id="org5d19acf">cut</h3>
<div class="outline-text-3" id="text-org5d19acf">
<ul class="org-ul">
<li><p>when type-apply</p><p></p><p><ul class="org-ul"></p><p><li><p><p></p><p>function cut</p><p></p></p><p><ul class="org-ul"></p><p><li><p>such as 'recur' and 'eq-apply'</p></li></ul></p><p><p></p><p>the information needed to apply the function body</p><p>is not there</p><p>so we use its type</p><p>to do a cut</p><p></p></p></li></p><p></p><p><li><p><p></p><p>data and variable</p><p></p></p><p><ul class="org-ul"></p><p><li><p>such as ':m.pre' and '{succ}'</p></li></ul></p><p><p></p><p>do not cut</p><p>they already contain more information</p><p>than their type</p><p></p></p></li></ul></p></li>

<li><p>can cut not happen in trunk ?</p><p><ul class="org-ul"></p><p><li><p>check the examples we have now</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-org635d571" class="outline-3">
<h3 id="org635d571">syntax</h3>
<div class="outline-text-3" id="text-org635d571">
</div><div id="outline-container-org50a2c8b" class="outline-4">
<h4 id="org50a2c8b">(:)</h4>
<div class="outline-text-4" id="text-org50a2c8b">
<ul class="org-ul">
<li><p>(:) collects its body</p><p>and treat the last value of the body</p><p>as the type to be unified</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-orgc119a38" class="outline-3">
<h3 id="orgc119a38">we need many languages</h3>
<div class="outline-text-3" id="text-orgc119a38">
<ol class="org-ol">
<li>type-name as data-constructor-name
<ul class="org-ul">
<li><p>can not use forgetful functor</p></li>
<li><p>can not overload data-constructor-name</p></li>
<li><p>simple sumtype and product-type</p></li></ul></li>

<li>type-name different from data-constructor-name
<ul class="org-ul">
<li><p>can use forgetful functor</p></li></ul></li></ol>
</div>
</div>
</div>

<div id="outline-container-orge35f559" class="outline-2">
<h2 id="orge35f559">number</h2>
<div class="outline-text-2" id="text-orge35f559">
</div><div id="outline-container-orge7bb1f5" class="outline-3">
<h3 id="orge7bb1f5">&lt;bool&gt;</h3>
<div class="outline-text-3" id="text-orge7bb1f5">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span>
  <span style="color: #66d9ef; font-weight: bold;">true</span>
  <span style="color: #66d9ef; font-weight: bold;">false</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  <span style="color: #66d9ef; font-weight: bold;">true</span>  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #66d9ef; font-weight: bold;">false</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfdf34a3" class="outline-3">
<h3 id="orgfdf34a3">&lt;nat&gt;</h3>
<div class="outline-text-3" id="text-orgfdf34a3">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span>
  zero
  succ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  zero <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
  succ <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> add <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:n</span>
    zero <span style="color: #a6e22e;">:m</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> succ<span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> mul <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:n</span>
    zero <span style="color: #a6e22e;">:n</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:n</span> add<span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> factorial <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:n</span>
    zero <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n</span> succ<span style="color: #797979;">]</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:n</span> mul<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org530bb96" class="outline-3">
<h3 id="org530bb96">&lt;even&gt;</h3>
<div class="outline-text-3" id="text-org530bb96">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;even&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.num</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  zero <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> zero <span style="color: #66d9ef; font-weight: bold;">&lt;even&gt;</span><span style="color: #696969;">)</span>
  plus-two <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> <span style="color: #66d9ef; font-weight: bold;">&lt;even&gt;</span><span style="color: #696969;">)</span>
            <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:m</span> succ succ <span style="color: #66d9ef; font-weight: bold;">&lt;even&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">proof</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> zero succ succ <span style="color: #66d9ef; font-weight: bold;">&lt;even&gt;</span><span style="color: #696969;">)</span>
  zero plus-two<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9dff5d1" class="outline-3">
<h3 id="org9dff5d1">&lt;eq&gt; &#x2013; an interface to the internal unification</h3>
<div class="outline-text-3" id="text-org9dff5d1">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.lhs</span> <span style="color: #ae81ff;">.rhs</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  <span style="color: #66d9ef; font-weight: bold;">refl</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:z</span> <span style="color: #a6e22e;">:z</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> eq-apply
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span><span style="color: #696969;">))</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:f</span> apply<span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #a6e22e;">:y</span> <span style="color: #a6e22e;">:f</span> apply<span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #66d9ef; font-weight: bold;">refl</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> eq-swap
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:y</span> <span style="color: #a6e22e;">:x</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #66d9ef; font-weight: bold;">refl</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> eq-compose
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span> <span style="color: #a6e22e;">:y</span> <span style="color: #a6e22e;">:z</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:z</span> <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #66d9ef; font-weight: bold;">refl</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orged99b90" class="outline-3">
<h3 id="orged99b90">add-associative &#x2013; structural induction proof</h3>
<div class="outline-text-3" id="text-orged99b90">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> add-associative
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #a6e22e;">:z</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> add <span style="color: #a6e22e;">:z</span> add
      <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #a6e22e;">:z</span> add add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:z</span>
    zero <span style="color: #66d9ef; font-weight: bold;">refl</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #a6e22e;">:z</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec3788" class="outline-3">
<h3 id="orgec3788">add-commutative</h3>
<div class="outline-text-3" id="text-orgec3788">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> add-commutative
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add<span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:n</span>
    zero <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> add-zero-commutative<span style="color: #797979;">]</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply
          <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add-succ-commutative eq-compose<span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> add-zero-commutative
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:m</span> zero add<span style="color: #f92672; font-weight: bold;">,</span> zero <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:m</span>
    zero <span style="color: #66d9ef; font-weight: bold;">refl</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply<span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+proof</span> add-succ-commutative
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:m</span> succ <span style="color: #a6e22e;">:n</span> add<span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:n</span>
    zero <span style="color: #66d9ef; font-weight: bold;">refl</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d1bf0d" class="outline-3">
<h3 id="org1d1bf0d"><span class="todo _note_">[note]</span> type-check detail of 'add-zero-commutative'</h3>
<div class="outline-text-3" id="text-org1d1bf0d">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:m</span> succ<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> succ<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-computed:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> zero add
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> zero add succ
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add succ
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-asserted:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> zero add
  zero <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> succ zero add
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> succ add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> succ add
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> succ add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add succ
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> succ add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add succ
  zero <span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.pre</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd487dc" class="outline-3">
<h3 id="orgfd487dc"><span class="todo _note_">[note]</span> type-check detail of 'add-commutative'</h3>
<div class="outline-text-3" id="text-orgfd487dc">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:n</span> succ<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-computed:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add-succ-commutative eq-swap eq-compose<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> add
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>succ<span style="color: #B380A8;">}</span> eq-apply
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add-succ-commutative eq-swap eq-compose<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> add succ
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add-succ-commutative eq-swap eq-compose<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> add succ
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span>
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ <span style="color: #a6e22e;">:m</span> add
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span>eq-swap eq-compose<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> add succ
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add succ <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span>
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> <span style="color: #a6e22e;">:m</span> add succ
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span>eq-compose<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> add succ
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-asserted:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add
  <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ add
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> add succ
  <span style="color: #a6e22e;">:n</span><span style="color: #ae81ff;">.pre</span> succ <span style="color: #a6e22e;">:m</span> add <span style="color: #66d9ef; font-weight: bold;">&lt;eq&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgda1f00a" class="outline-2">
<h2 id="orgda1f00a">&lt;list&gt;</h2>
<div class="outline-text-2" id="text-orgda1f00a">
</div><div id="outline-container-orgc3cb253" class="outline-3">
<h3 id="orgc3cb253">&lt;list&gt;</h3>
<div class="outline-text-3" id="text-orgc3cb253">
<ul class="org-ul">
<li><p>&lt;list&gt; := &lt;null&gt; | (&lt;sexp&gt; . &lt;list&gt;)</p></li></ul>

<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.&lt;t&gt;</span> <span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  null <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
  cons <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span>
        <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a30bd2" class="outline-3">
<h3 id="org9a30bd2">length</h3>
<div class="outline-text-3" id="text-org9a30bd2">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> length <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l</span>
    null zero
    cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> succ<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f10926" class="outline-3">
<h3 id="org5f10926">map</h3>
<div class="outline-text-3" id="text-org5f10926">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> map <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span><span style="color: #696969;">))</span>
           <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l</span>
    null null
    cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:f</span> <span style="color: #66d9ef; font-weight: bold;">recur</span><span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:f</span> apply<span style="color: #f92672; font-weight: bold;">,</span> cons<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b12fa1" class="outline-3">
<h3 id="org3b12fa1">ref</h3>
<div class="outline-text-3" id="text-org3b12fa1">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> ref <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:index</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:index</span>
    zero <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span><span style="color: #797979;">]</span>
    succ <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:index</span><span style="color: #ae81ff;">.pre</span> <span style="color: #66d9ef; font-weight: bold;">recur</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7d323b" class="outline-3">
<h3 id="orga7d323b">remove-first</h3>
<div class="outline-text-3" id="text-orga7d323b">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> remove-first
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l</span>
    null null
    cons <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:x</span> equal?<span style="color: #797979;">]</span>
           <span style="color: #66d9ef; font-weight: bold;">true</span>  <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span>
           <span style="color: #66d9ef; font-weight: bold;">false</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:x</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgec9c72b" class="outline-2">
<h2 id="orgec9c72b">&lt;has-length&gt;</h2>
<div class="outline-text-2" id="text-orgec9c72b">
</div><div id="outline-container-org27acd45" class="outline-3">
<h3 id="org27acd45">&lt;has-length&gt;</h3>
<div class="outline-text-3" id="text-org27acd45">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.list</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.length</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
                     <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  null-has-length <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> null zero <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #696969;">)</span>
  cons-has-length <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #696969;">)</span>
                   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:a</span> cons <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> map-has-length
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:has-length</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:f</span> map <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:has-length</span>
    null-has-length null-has-length
    cons-has-length <span style="color: #797979;">[</span><span style="color: #a6e22e;">:has-length</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> cons-has-length<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d37588" class="outline-3">
<h3 id="org1d37588"><span class="todo _note_">[note]</span> type-check detail of 'map-has-length'</h3>
<div class="outline-text-3" id="text-org1d37588">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:has-length</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:has-length</span> cons-has-length<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:has-length</span> <span style="color: #a6e22e;">:has-length</span><span style="color: #ae81ff;">.cdr</span> cons-has-length<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:has-length</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:n#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:has-length</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:a#0</span> cons <span style="color: #a6e22e;">:n#0</span> succ <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:a#0</span> cons<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:n#0</span> succ<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-computed:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:has-length</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> cons-has-length<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:n#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #66d9ef; font-weight: bold;">recur</span> cons-has-length<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:f#0</span> map <span style="color: #a6e22e;">:n#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span>cons-has-length<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:f#0</span> map <span style="color: #a6e22e;">:a#1</span> cons <span style="color: #a6e22e;">:n#0</span> succ <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-asserted:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:f</span> map <span style="color: #a6e22e;">:n</span> <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:a#0</span> cons <span style="color: #a6e22e;">:f</span> map <span style="color: #a6e22e;">:n#0</span> succ <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l#0</span> <span style="color: #a6e22e;">:f</span> map <span style="color: #a6e22e;">:a#0</span> <span style="color: #a6e22e;">:f</span> apply cons <span style="color: #a6e22e;">:n#0</span> succ <span style="color: #66d9ef; font-weight: bold;">&lt;has-length&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb306304" class="outline-2">
<h2 id="orgb306304">&lt;sexp&gt; &#x2013; symbol expression</h2>
<div class="outline-text-2" id="text-orgb306304">
</div><div id="outline-container-orgc663cc0" class="outline-3">
<h3 id="orgc663cc0">&lt;sexp&gt;</h3>
<div class="outline-text-3" id="text-orgc663cc0">
<ul class="org-ul">
<li><p>&lt;sexp&gt; := &lt;symbol&gt; | &lt;list&gt;</p></li></ul>

<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">note</span>

  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> <span style="color: #66d9ef; font-weight: bold;">&lt;exp&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.&lt;t&gt;</span> <span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;exp&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">))</span>

  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #66d9ef; font-weight: bold;">&lt;exp&gt;</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org922da6b" class="outline-3">
<h3 id="org922da6b">subst</h3>
<div class="outline-text-3" id="text-org922da6b">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> subst <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:new</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:old</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:sexp</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span><span style="color: #696969;">)</span>
             <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">case</span> <span style="color: #a6e22e;">:sexp</span>
    <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:sexp</span> <span style="color: #a6e22e;">:old</span> equal?<span style="color: #797979;">]</span>
               <span style="color: #66d9ef; font-weight: bold;">true</span>  <span style="color: #a6e22e;">:new</span>
               <span style="color: #66d9ef; font-weight: bold;">false</span> <span style="color: #a6e22e;">:sexp</span><span style="color: #696969;">)</span>
    <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span>   <span style="color: #797979;">[</span><span style="color: #a6e22e;">:new</span> <span style="color: #a6e22e;">:old</span> <span style="color: #a6e22e;">:sexp</span> subst-list<span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> subst-list <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:new</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:old</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:list</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
                  <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;sexp&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:list</span>
    null null
    cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:new</span> <span style="color: #a6e22e;">:old</span> <span style="color: #a6e22e;">:list</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span>
          <span style="color: #a6e22e;">:new</span> <span style="color: #a6e22e;">:old</span> <span style="color: #a6e22e;">:list</span><span style="color: #ae81ff;">.car</span> subst
          cons<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5ec846" class="outline-2">
<h2 id="org5ec846">&lt;lexp&gt; &#x2013; lambda expression</h2>
<div class="outline-text-2" id="text-org5ec846">
</div><div id="outline-container-org9457fc4" class="outline-3">
<h3 id="org9457fc4">&lt;lexp&gt;</h3>
<div class="outline-text-3" id="text-org9457fc4">
<ul class="org-ul">
<li><p>&lt;lexp&gt; := &lt;var&gt; | (lambda (&lt;var&gt;) &lt;lexp&gt;) | (&lt;lexp&gt; &lt;lexp&gt;)</p></li></ul>

<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span>
  var-lexp <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;var&gt;</span><span style="color: #696969;">)</span>
  lam-lexp <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;var&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.body</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">)</span>
  app-lexp <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.rator</span> <span style="color: #ae81ff;">.rand</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  var-lexp <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;var&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">)</span>
  lam-lexp <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;var&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.body</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">)</span>
  app-lexp <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.rator</span> <span style="color: #ae81ff;">.rand</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc223559" class="outline-3">
<h3 id="orgc223559">occurs-free?</h3>
<div class="outline-text-3" id="text-orgc223559">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> occurs-free?
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:search-var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;var&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:lexp</span> <span style="color: #66d9ef; font-weight: bold;">&lt;lexp&gt;</span><span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:lexp</span>
    var-lexp <span style="color: #797979;">[</span><span style="color: #a6e22e;">:search-var</span> <span style="color: #a6e22e;">:lexp</span><span style="color: #ae81ff;">.var</span> equal?<span style="color: #797979;">]</span>
    lam-lexp <span style="color: #797979;">[</span><span style="color: #a6e22e;">:search-var</span> <span style="color: #a6e22e;">:lexp</span><span style="color: #ae81ff;">.var</span> equal? not
              <span style="color: #a6e22e;">:search-var</span> <span style="color: #a6e22e;">:lexp</span><span style="color: #ae81ff;">.body</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> and<span style="color: #797979;">]</span>
    app-lexp <span style="color: #797979;">[</span><span style="color: #a6e22e;">:search-var</span> <span style="color: #a6e22e;">:lexp</span><span style="color: #ae81ff;">.rator</span> <span style="color: #66d9ef; font-weight: bold;">recur</span>
              <span style="color: #a6e22e;">:search-var</span> <span style="color: #a6e22e;">:lexp</span><span style="color: #ae81ff;">.rand</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> or<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org914016c" class="outline-2">
<h2 id="org914016c">&lt;vector&gt;</h2>
<div class="outline-text-2" id="text-org914016c">
</div><div id="outline-container-org54e7379" class="outline-3">
<h3 id="org54e7379">&lt;vector&gt;</h3>
<div class="outline-text-3" id="text-org54e7379">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span>
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.length</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.&lt;t&gt;</span> <span style="color: #696969;">)</span>
   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  null <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> zero <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
  cons <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span>
        <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org987d8a6" class="outline-3">
<h3 id="org987d8a6">append</h3>
<div class="outline-text-3" id="text-org987d8a6">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> append <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l0</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l1</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
              <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l1</span>
    null <span style="color: #a6e22e;">:l0</span>
    cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l0</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9168f4a" class="outline-3">
<h3 id="org9168f4a">map</h3>
<div class="outline-text-3" id="text-org9168f4a">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> map <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span><span style="color: #696969;">))</span>
           <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l</span>
    null null
    cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:f</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:f</span> apply cons<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccaf9b5" class="outline-3">
<h3 id="orgccaf9b5"><span class="todo _note_">[note]</span> type-check detail of 'append'</h3>
<div class="outline-text-3" id="text-orgccaf9b5">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l0</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l1</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l1</span> cons<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:l1</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:t#0</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l1</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> succ <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:n#0</span> succ<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:t</span> :t#0<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-computed:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l0</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span> <span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n#0</span> add <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n#0</span> add <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span> <span style="color: #a6e22e;">:t#0</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span>cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n#0</span> add succ <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-asserted:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n#0</span> succ add <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n#0</span> add succ <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb74e388" class="outline-3">
<h3 id="orgb74e388"><span class="todo _note_">[note]</span> type-check detail of 'map'</h3>
<div class="outline-text-3" id="text-orgb74e388">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:t1</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:t1</span> :t2<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l</span> cons<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> cons<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:t#0</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> succ <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:n#0</span> succ<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">=</span> <span style="color: #a6e22e;">:t1</span> :t#0<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-computed:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:f</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:f</span> apply cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t#0</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:t1</span> <span style="color: #a6e22e;">:t2</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:f</span> apply cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t2</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:f</span> apply cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t2</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span> <span style="color: #a6e22e;">:t#0</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:f</span> apply cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> <span style="color: #a6e22e;">:t2</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span> <span style="color: #a6e22e;">:t2</span><span style="color: #797979;">]</span>
 <span style="color: #797979;">[</span>cons<span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> succ <span style="color: #a6e22e;">:t2</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>

<span style="color: #696969;">(</span>type-asserted:

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:t2</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span>

 <span style="color: #797979;">[</span><span style="color: #a6e22e;">:n#0</span> succ <span style="color: #a6e22e;">:t2</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org80dc897" class="outline-3">
<h3 id="org80dc897">&lt;list&gt; as forgetful functor &#x2013; to reuse &lt;vector&gt;</h3>
<div class="outline-text-3" id="text-org80dc897">
<ul class="org-ul">
<li><p>forgetful functor of type [not type-class]</p></li></ul>

<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">forget</span> <span style="color: #ae81ff;">.length</span> <span style="color: #66d9ef; font-weight: bold;">&lt;vector&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">note</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> append <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l0</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:l1</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
                <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:l1</span>
      null <span style="color: #a6e22e;">:l0</span>
      cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:l0</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:l1</span><span style="color: #ae81ff;">.car</span> cons<span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org720dba3" class="outline-2">
<h2 id="org720dba3">&lt;binary-tree&gt;</h2>
<div class="outline-text-2" id="text-org720dba3">
</div><div id="outline-container-org36a2069" class="outline-3">
<h3 id="org36a2069">&lt;binary-tree&gt;</h3>
<div class="outline-text-3" id="text-org36a2069">
<ul class="org-ul">
<li><p>&lt;binary-tree&gt; := () | (&lt;int&gt; &lt;binary-tree&gt; &lt;binary-tree&gt;)</p></li></ul>

<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-tree&gt;</span>
  null
  node <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.value</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.left</span> <span style="color: #ae81ff;">.right</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-tree&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-tree&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  null <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-tree&gt;</span><span style="color: #696969;">)</span>
  node <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.value</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.left</span> <span style="color: #ae81ff;">.right</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-tree&gt;</span><span style="color: #696969;">)</span>
        <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-tree&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org43fcb5" class="outline-2">
<h2 id="org43fcb5">&lt;binary-search-tree&gt;</h2>
<div class="outline-text-2" id="text-org43fcb5">
</div><div id="outline-container-org21f1a3e" class="outline-3">
<h3 id="org21f1a3e">&lt;binary-search-tree&gt;</h3>
<div class="outline-text-3" id="text-org21f1a3e">
<ul class="org-ul">
<li><p>&lt;binary-search-tree&gt; := () | (&lt;int&gt; &lt;binary-search-tree&gt; &lt;binary-search-tree&gt;)</p></li>

<li><p>not all semantic are expressed in the above grammar.</p><p><ol class="org-ol"></p><p><li>key in the left subtree &lt;= key in the current node</li></p><p><li>keys in the right subtree &gt; key in the current node</li></ol></p></li></ul>

<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;order&gt;</span>
  lt eq gt<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span>
  null
  node <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.key</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.value</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.left</span> <span style="color: #ae81ff;">.right</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf92fdaa" class="outline-3">
<h3 id="orgf92fdaa">search</h3>
<div class="outline-text-3" id="text-orgf92fdaa">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> search <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:tree</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
              <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:tree</span>
    null null
    node <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> compare<span style="color: #797979;">]</span>
           lt <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">recur</span><span style="color: #797979;">]</span>
           eq <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #797979;">]</span>
           gt <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">recur</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4451965" class="outline-3">
<h3 id="org4451965">insert</h3>
<div class="outline-text-3" id="text-org4451965">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> insert <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:tree</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:vlaue</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span>
              <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:tree</span>
    null <span style="color: #797979;">[</span><span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:value</span> null null node<span style="color: #797979;">]</span>
    node <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> compare<span style="color: #797979;">]</span>
           lt <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.value</span>
               <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:value</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> node<span style="color: #797979;">]</span>
           eq <span style="color: #797979;">[</span><span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:value</span>
               <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> node<span style="color: #797979;">]</span>
           gt <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.value</span>
               <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> <span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:value</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> node<span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org52fb483" class="outline-3">
<h3 id="org52fb483">delete</h3>
<div class="outline-text-3" id="text-org52fb483">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> delete <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:tree</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
              <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:tree</span>
    null null
    node <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> compare<span style="color: #797979;">]</span>
           lt <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.value</span>
               <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> node<span style="color: #797979;">]</span>
           eq <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span> delete-node<span style="color: #797979;">]</span>
           gt <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.value</span>
               <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> <span style="color: #a6e22e;">:key</span> <span style="color: #66d9ef; font-weight: bold;">recur</span> node<span style="color: #797979;">]</span><span style="color: #696969;">)))</span>


<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> delete-node <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:tree</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
                   <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> null?<span style="color: #797979;">]</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> null?<span style="color: #797979;">]</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span><span style="color: #797979;">]</span>
        <span style="color: #66d9ef; font-weight: bold;">else</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> left-most-key-and-value <span style="color: #fd971f;">:value!</span> <span style="color: #fd971f;">:key!</span>
              <span style="color: #a6e22e;">:key</span> <span style="color: #a6e22e;">:value</span>
              <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span>
              <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.right</span> <span style="color: #a6e22e;">:key</span> delete
              node<span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> left-most-key-and-value <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:tree</span> <span style="color: #66d9ef; font-weight: bold;">&lt;binary-search-tree&gt;</span><span style="color: #696969;">)</span>
                               <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> null?<span style="color: #797979;">]</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.key</span> <span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.value</span><span style="color: #797979;">]</span>
        <span style="color: #66d9ef; font-weight: bold;">else</span> <span style="color: #797979;">[</span><span style="color: #a6e22e;">:tree</span><span style="color: #ae81ff;">.left</span> <span style="color: #66d9ef; font-weight: bold;">recur</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2fed7be" class="outline-2">
<h2 id="org2fed7be"><span class="todo _gt__lt_">&gt;&lt;</span> &lt;red-black-tree&gt;</h2>
<div class="outline-text-2" id="text-org2fed7be">
</div><div id="outline-container-org722aa0e" class="outline-3">
<h3 id="org722aa0e"><span class="todo _note_">[note]</span> </h3>
<div class="outline-text-3" id="text-org722aa0e">
<ul class="org-ul">
<li><p>in addition to the requirements imposed on a binary search tree</p><p>the following must be satisfied by a redblack tree :</p><p><ol class="org-ol"></p><p><li>each node is either red or black.</li></p><p><li>the root is black. [this rule is sometimes omitted.]</li></p><p><li>all leaves are black.</li></p><p><li>if a node is red, then both its children are black.</li></p><p><li>every path from a given node to any of its descendant nil nodes</p><p>contains the same number of black nodes.</p><p></p><p><ul class="org-ul"></p><p><li><p>the number of black nodes from the root to a node</p><p>is the node's black depth</p></li></p><p></p><p><li><p>the uniform number of black nodes in all paths</p><p>from root to the leaves</p><p>is called the black-height of the redblack tree.</p></li></ul></li></ol></p></li>

<li><p>property of redblack trees :</p><p>the path from the root to the farthest leaf</p><p>is no more than twice as long as the path</p><p>from the root to the nearest leaf.</p><p>thus, the tree is roughly height-balanced.</p></li></ul>
</div>
</div>

<div id="outline-container-org6832a36" class="outline-3">
<h3 id="org6832a36">&lt;red-black-tree&gt; &#x2013; extrinsic</h3>
<div class="outline-text-3" id="text-org6832a36">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;color&gt;</span>
  red
  black<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;red-black-tree&gt;</span>
  null
  node <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.color</span> <span style="color: #66d9ef; font-weight: bold;">&lt;color&gt;</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.key</span> <span style="color: #66d9ef; font-weight: bold;">&lt;symbol&gt;</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.value</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.left</span> <span style="color: #ae81ff;">.right</span> <span style="color: #66d9ef; font-weight: bold;">&lt;red-black-tree&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org999306a" class="outline-3">
<h3 id="org999306a">&lt;red-black-tree&gt; &#x2013; intrinsic</h3>
<div class="outline-text-3" id="text-org999306a">
<div class="org-src-container">

<pre class="src src-jojo"></pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgff307da" class="outline-2">
<h2 id="orgff307da">type-class as subtype of <a id="orgea36df9"></a></h2>
<div class="outline-text-2" id="text-orgff307da">
</div><div id="outline-container-org4b45594" class="outline-3">
<h3 id="org4b45594"><a id="orgf22d237"></a></h3>
<div class="outline-text-3" id="text-org4b45594">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+subtype</span>  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span>  <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  map <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:x1</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;functor&gt;</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span><span style="color: #696969;">))</span>
       <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;functor&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+member</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span> 
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+imp</span> map <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:x1</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span><span style="color: #696969;">))</span>
             <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;list&gt;</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:x1</span>
      null null
      cons <span style="color: #797979;">[</span><span style="color: #a6e22e;">:x1</span><span style="color: #ae81ff;">.cdr</span> <span style="color: #a6e22e;">:f</span> <span style="color: #66d9ef; font-weight: bold;">recur</span><span style="color: #f92672; font-weight: bold;">,</span> <span style="color: #a6e22e;">:x1</span><span style="color: #ae81ff;">.car</span> <span style="color: #a6e22e;">:f</span> apply<span style="color: #f92672; font-weight: bold;">,</span> cons<span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1475610" class="outline-3">
<h3 id="org1475610"><a id="orga3bd8e3"></a></h3>
<div class="outline-text-3" id="text-org1475610">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+subtype</span>  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span>  <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  return <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:val</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;monad&gt;</span><span style="color: #696969;">)</span>
  bind <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:value</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;monad&gt;</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;monad&gt;</span><span style="color: #696969;">))</span>
        <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;monad&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1b99d2" class="outline-3">
<h3 id="orgb1b99d2">&lt;maybe&gt;</h3>
<div class="outline-text-3" id="text-orgb1b99d2">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+type</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.&lt;t&gt;</span> <span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  nothing <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span><span style="color: #696969;">)</span>
  just <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.value</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+member</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span> 
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+imp</span> return <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:v</span> <span style="color: #a6e22e;">:&lt;t&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span><span style="color: #696969;">)</span>
    <span style="color: #a6e22e;">:v</span> just<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+imp</span> bind <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;t1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span><span style="color: #696969;">))</span>
              <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;t2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;maybe&gt;</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #a6e22e;">:m</span>
      nothing nothing
      just <span style="color: #797979;">[</span><span style="color: #a6e22e;">:m</span><span style="color: #ae81ff;">.value</span> <span style="color: #a6e22e;">:f</span> apply<span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge68e0c0" class="outline-3">
<h3 id="orge68e0c0">&lt;state&gt;</h3>
<div class="outline-text-3" id="text-orge68e0c0">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+var</span> <span style="color: #66d9ef; font-weight: bold;">&lt;state&gt;</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #a6e22e;">:&lt;v&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> :&lt;v&gt;<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+member</span> <span style="color: #B380A8;">{</span><span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;state&gt;</span><span style="color: #B380A8;">}</span> 
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+imp</span> return <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:v</span> <span style="color: #a6e22e;">:&lt;v&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #a6e22e;">:&lt;v&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;state&gt;</span><span style="color: #696969;">)</span>
    <span style="color: #B380A8;">{</span><span style="color: #a6e22e;">:v</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+imp</span> bind <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #a6e22e;">:&lt;v1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;state&gt;</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:f</span> <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:&lt;v1&gt;</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #a6e22e;">:&lt;v2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;state&gt;</span><span style="color: #696969;">))</span>
              <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #a6e22e;">:&lt;s&gt;</span> <span style="color: #a6e22e;">:&lt;v2&gt;</span> <span style="color: #66d9ef; font-weight: bold;">&lt;state&gt;</span><span style="color: #696969;">)</span>
    <span style="color: #B380A8;">{</span><span style="color: #a6e22e;">:m</span> apply <span style="color: #a6e22e;">:f</span> apply apply<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org11243ec" class="outline-2">
<h2 id="org11243ec">quotype &#x2013; quotient type</h2>
<div class="outline-text-2" id="text-org11243ec">
</div><div id="outline-container-org3b0822b" class="outline-3">
<h3 id="org3b0822b"><span class="todo _note_">[note]</span> </h3>
<div class="outline-text-3" id="text-org3b0822b">
<ul class="org-ul">
<li><p>basic 'equal?'</p></li>

<li><p><p></p><p>to use quotype is to to re-implement 'equal?'.</p><p></p></p><p></p><p><p></p><p>or, generally,</p><p>to re-implement interface functions</p><p>of type and type-class</p><p></p></p></li></ul>
</div>
</div>

<div id="outline-container-org4bde230" class="outline-3">
<h3 id="org4bde230">&lt;int&gt;</h3>
<div class="outline-text-3" id="text-org4bde230">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-quotype</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.left</span> <span style="color: #ae81ff;">.right</span> <span style="color: #66d9ef; font-weight: bold;">&lt;nat&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org214446a" class="outline-3">
<h3 id="org214446a">equal?</h3>
<div class="outline-text-3" id="text-org214446a">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> equal? <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #a6e22e;">:x</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:x</span><span style="color: #ae81ff;">.right</span> sub
  <span style="color: #a6e22e;">:y</span><span style="color: #ae81ff;">.left</span> <span style="color: #a6e22e;">:y</span><span style="color: #ae81ff;">.right</span> sub
  equal?<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeadc8df" class="outline-3">
<h3 id="orgeadc8df">&lt;fraction&gt;</h3>
<div class="outline-text-3" id="text-orgeadc8df">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+simple-quotype</span> <span style="color: #66d9ef; font-weight: bold;">&lt;fraction&gt;</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">.</span> <span style="color: #ae81ff;">.up</span> <span style="color: #ae81ff;">.down</span> <span style="color: #66d9ef; font-weight: bold;">&lt;int&gt;</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgceab14c" class="outline-3">
<h3 id="orgceab14c">equal?</h3>
<div class="outline-text-3" id="text-orgceab14c">
<div class="org-src-container">

<pre class="src src-jojo"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+fun</span> equal? <span style="color: #696969;">(</span><span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #a6e22e;">:x</span> <span style="color: #a6e22e;">:y</span> <span style="color: #66d9ef; font-weight: bold;">&lt;fraction&gt;</span><span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">--</span> <span style="color: #66d9ef; font-weight: bold;">&lt;bool&gt;</span><span style="color: #696969;">)</span>
  <span style="color: #a6e22e;">:x</span><span style="color: #ae81ff;">.up</span> <span style="color: #a6e22e;">:y</span><span style="color: #ae81ff;">.down</span> mul
  <span style="color: #a6e22e;">:y</span><span style="color: #ae81ff;">.up</span> <span style="color: #a6e22e;">:x</span><span style="color: #ae81ff;">.down</span> mul
  equal?<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: xieyuheng</p>
<p class="date">Created: 2017-10-12 Thu 18:33</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
